{% extends "layout.html" %}
{% block title %}Licenses{% endblock %}

{% block content %}
<!-- Store radiologists data for JavaScript -->
<div id="radiologistsData" data-radiologists='{{ radiologists|tojson|safe }}' class="hidden"></div>

<!-- Header Section with improved styling -->
<div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
  <div class="mb-4 lg:mb-0">
    <h2 class="text-3xl font-bold text-gray-900 mb-2">License Management</h2>
    <p class="text-gray-600">Track and manage radiologist certifications and licenses</p>
  </div>
  <div class="flex items-center gap-3">
    <div class="flex items-center gap-2 text-sm text-gray-600">
      <div class="w-3 h-3 bg-green-100 border border-green-300 rounded"></div>
      <span>Active</span>
    </div>
    <div class="flex items-center gap-2 text-sm text-gray-600">
      <div class="w-3 h-3 bg-red-100 border border-red-300 rounded"></div>
      <span>Expired</span>
    </div>
  </div>
</div>

<!-- Enhanced Search and Filter Section -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
  <div class="flex flex-col lg:flex-row gap-4">
    <!-- Search Input with Icon -->
    <div class="flex-1 relative">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <i class="fas fa-search text-gray-400"></i>
      </div>
      <input
        type="text"
        id="licenseSearch"
        placeholder="Search by state"
        class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
        onkeyup="debounceSearch()" />
    </div>
    
    <!-- Doctor Filter Dropdown -->
    <div class="w-full lg:w-64 relative">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <i class="fas fa-user-md text-gray-400"></i>
      </div>
      <select
        id="doctorFilter"
        class="w-full pl-10 pr-8 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors appearance-none bg-white"
        onchange="loadLicenses()">
        <option value="">All Doctors</option>
        {% for rad in radiologists %}
        <option value="{{ rad.id }}">{{ rad.name }}</option>
        {% endfor %}
      </select>
      <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
        <i class="fas fa-chevron-down text-gray-400"></i>
      </div>
    </div>
    
    <!-- Status Filter Pills -->
    <div class="flex gap-2">
      <button onclick="filterByStatus('all')" 
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 bg-blue-600 text-white shadow-sm hover:bg-blue-700 active-filter" 
              data-status="all">
        <i class="fas fa-list mr-2"></i>All
      </button>
      <button onclick="filterByStatus('Active')" 
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-green-100 hover:text-green-700" 
              data-status="Active">
        <i class="fas fa-check-circle mr-2"></i>Active
      </button>
      <button onclick="filterByStatus('Expired')" 
              class="px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 bg-gray-100 text-gray-700 hover:bg-red-100 hover:text-red-700" 
              data-status="Expired">
        <i class="fas fa-exclamation-triangle mr-2"></i>Expired
      </button>
    </div>
  </div>
</div>

<!-- Enhanced Licenses Table -->
<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
  <!-- Table Header -->
  <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-gray-900 flex items-center">
        <i class="fas fa-certificate text-blue-600 mr-2"></i>
        License Records
      </h3>
      <div class="text-sm text-gray-600">
        <span id="totalItems">{{ total_count }}</span> total licenses
      </div>
    </div>
  </div>
  
  <!-- Table Content -->
  <div class="overflow-x-auto">
    <table id="licensesTable" class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-user-md mr-2"></i>Doctor
          </th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-map-marker-alt mr-2"></i>State
          </th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-stethoscope mr-2"></i>Specialty
          </th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-info-circle mr-2"></i>Status
          </th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-tags mr-2"></i>Tags
          </th>
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-calendar-alt mr-2"></i>Expiration
          </th>
          {% if session.user.role == 'admin' %}
          <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            <i class="fas fa-cog mr-2"></i>Actions
          </th>
          {% endif %}
        </tr>
      </thead>
      <tbody id="licensesTableBody" class="bg-white divide-y divide-gray-200">
        {% for cert in certifications %}
        {% set is_expired = cert.status == 'Expired' or cert.status == 'Revoked' or (cert.expiration_date and cert.expiration_date < now.strftime('%Y-%m-%d')) %}
        <tr id="license-row-{{ cert.id }}" 
            class="hover:bg-gray-50 transition-colors duration-150 {% if is_expired %}bg-red-50 {% else %}bg-green-50 {% endif %}"
            data-doctor-id="{{ cert.radiologist_id }}">
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="view-mode">
              <div class="flex items-center">
                <div class="flex-shrink-0 h-10 w-10">
                  <div class="h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                    <span class="text-white font-medium text-sm">{{ cert.radiologists.name[:2].upper() }}</span>
                  </div>
                </div>
                <div class="ml-4">
                  <a href="/radmapping/doctors/{{ cert.radiologist_id }}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium transition-colors">
                    {{ cert.radiologists.name }}
                  </a>
                </div>
              </div>
            </span>
            <select class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              {% for rad in radiologists %}
              <option value="{{ rad.id }}" {% if rad.id == cert.radiologist_id %}selected{% endif %}>{{ rad.name }}</option>
              {% endfor %}
            </select>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="view-mode">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                <i class="fas fa-map-marker-alt mr-1"></i>{{ cert.state }}
              </span>
            </span>
            <input type="text" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="{{ cert.state }}">
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="view-mode text-sm text-gray-900">{{ cert.specialty }}</span>
            <input type="text" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="{{ cert.specialty }}">
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="view-mode">
              {% if cert.status == 'Active' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <i class="fas fa-check-circle mr-1"></i>{{ cert.status }}
                </span>
              {% elif cert.status == 'Expired' or cert.status == 'Revoked' %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  <i class="fas fa-times-circle mr-1"></i>{{ cert.status }}
                </span>
              {% else %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  <i class="fas fa-clock mr-1"></i>{{ cert.status }}
                </span>
              {% endif %}
            </span>
            <select class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="Active" {% if cert.status == 'Active' %}selected{% endif %}>Active</option>
              <option value="Pending" {% if cert.status == 'Pending' %}selected{% endif %}>Pending</option>
              <option value="Expired" {% if cert.status == 'Expired' %}selected{% endif %}>Expired</option>
              <option value="Revoked" {% if cert.status == 'Revoked' %}selected{% endif %}>Revoked</option>
            </select>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="view-mode">
              {% if cert.tags %}
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  <i class="fas fa-tag mr-1"></i>{{ cert.tags }}
                </span>
              {% else %}
                <span class="text-gray-400 text-sm">No tags</span>
              {% endif %}
            </span>
            <input type="text" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="{{ cert.tags }}">
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="view-mode">
              <div class="flex items-center">
                <i class="fas fa-calendar-alt text-gray-400 mr-2"></i>
                <span class="text-sm text-gray-900">{{ cert.expiration_date }}</span>
              </div>
            </span>
            <input type="date" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="{{ cert.expiration_date }}">
          </td>
          {% if session.user.role == 'admin' %}
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <div class="view-mode flex items-center gap-2">
              <button onclick="toggleEditMode('{{ cert.id }}')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 transition-colors">
                <i class="fas fa-edit mr-1"></i>Edit
              </button>
              <form method="POST" action="/radmapping/doctors/{{ cert.radiologist_id }}/licenses/{{ cert.id }}/delete" class="inline">
                <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 transition-colors">
                  <i class="fas fa-trash mr-1"></i>Delete
                </button>
              </form>
            </div>
            <div class="edit-mode hidden flex items-center gap-2">
              <button onclick="saveLicense('{{ cert.id }}')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 transition-colors">
                <i class="fas fa-save mr-1"></i>Save
              </button>
              <button onclick="cancelEdit('{{ cert.id }}')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors">
                <i class="fas fa-times mr-1"></i>
              </button>
            </div>
          </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  
  <!-- Enhanced Pagination -->
  <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
      <div class="text-sm text-gray-700 mb-4 sm:mb-0">
        <span class="font-medium">Showing</span>
        <span class="font-medium text-blue-600" id="startItem">1</span>
        <span>to</span>
        <span class="font-medium text-blue-600" id="endItem">{{ per_page }}</span>
        <span>of</span>
        <span class="font-medium text-blue-600" id="totalItems">{{ total_count }}</span>
        <span>entries</span>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="changePage('prev')" id="prevPage" 
                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          <i class="fas fa-chevron-left mr-2"></i>Previous
        </button>
        <button onclick="changePage('next')" id="nextPage" 
                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
          Next<i class="fas fa-chevron-right ml-2"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<style>
/* Custom styles for enhanced appearance */
.active-filter {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* Smooth transitions for status badges */
.status-badge {
  transition: all 0.2s ease-in-out;
}

.status-badge:hover {
  transform: scale(1.05);
}

/* Enhanced table row hover effects */
tbody tr:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

/* Custom scrollbar for table */
.overflow-x-auto::-webkit-scrollbar {
  height: 8px;
}

.overflow-x-auto::-webkit-scrollbar-track {
  background: #f1f5f9;
  border-radius: 4px;
}

.overflow-x-auto::-webkit-scrollbar-thumb {
  background: linear-gradient(to right, #3b82f6, #8b5cf6);
  border-radius: 4px;
}

.overflow-x-auto::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(to right, #2563eb, #7c3aed);
}
</style>

<!-- Keep all your existing JavaScript exactly as is -->
<script>
let currentStatusFilter = 'all';
let currentSearchTerm = '';
let currentPage = {{ current_page }};
const itemsPerPage = {{ per_page }};
let totalCount = {{ total_count }};
let searchTimeout;

// Get radiologists data from the hidden div
const radiologists = JSON.parse(document.getElementById('radiologistsData').dataset.radiologists);

// Load licenses when page loads
document.addEventListener('DOMContentLoaded', function() {
  loadLicenses();
});

function debounceSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    currentSearchTerm = document.getElementById('licenseSearch').value;
    currentPage = 1;
    loadLicenses();
  }, 300);
}

function loadLicenses() {
  const searchTerm = document.getElementById('licenseSearch').value;
  const doctorId = document.getElementById('doctorFilter').value;
  
  fetch(`/radmapping/licenses/search?page=${currentPage}&search=${encodeURIComponent(searchTerm)}&doctor=${encodeURIComponent(doctorId)}&status=${currentStatusFilter}`)
    .then(response => response.json())
    .then(data => {
      updateTable(data.certifications);
      updatePagination(data.total_count);
    });
}

function updateTable(certifications) {
  const tbody = document.getElementById('licensesTableBody');
  tbody.innerHTML = '';
  
  certifications.forEach(cert => {
    const isExpired = cert.status === 'Expired' || cert.status === 'Revoked' || 
                     (cert.expiration_date && cert.expiration_date < new Date().toISOString().split('T')[0]);
    
    const row = document.createElement('tr');
    row.id = `license-row-${cert.id}`;
    row.className = `hover:bg-gray-50 transition-colors duration-150 ${isExpired ? 'bg-red-50 ' : 'bg-green-50 '}`;
    row.dataset.doctorId = cert.radiologist_id;
    
    // Create doctor select options
    const doctorOptions = radiologists.map(rad => 
      `<option value="${rad.id}" ${rad.id === cert.radiologist_id ? 'selected' : ''}>${rad.name}</option>`
    ).join('');
    
    // Create status badge
    let statusBadge = '';
    if (cert.status === 'Active') {
      statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
        <i class="fas fa-check-circle mr-1"></i>${cert.status}
      </span>`;
    } else if (cert.status === 'Expired' || cert.status === 'Revoked') {
      statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
        <i class="fas fa-times-circle mr-1"></i>${cert.status}
      </span>`;
    } else {
      statusBadge = `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
        <i class="fas fa-clock mr-1"></i>${cert.status}
      </span>`;
    }
    
    row.innerHTML = `
      <td class="px-6 py-4 whitespace-nowrap">
        <span class="view-mode">
          <div class="flex items-center">
            <div class="flex-shrink-0 h-10 w-10">
              <div class="h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center">
                <span class="text-white font-medium text-sm">${cert.radiologists.name.substring(0, 2).toUpperCase()}</span>
              </div>
            </div>
            <div class="ml-4">
              <a href="/radmapping/doctors/${cert.radiologist_id}" target="_blank" class="text-blue-600 hover:text-blue-800 font-medium transition-colors">
                ${cert.radiologists.name}
              </a>
            </div>
          </div>
        </span>
        <select class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          ${doctorOptions}
        </select>
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <span class="view-mode">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            <i class="fas fa-map-marker-alt mr-1"></i>${cert.state}
          </span>
        </span>
        <input type="text" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="${cert.state}">
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <span class="view-mode text-sm text-gray-900">${cert.specialty || ''}</span>
        <input type="text" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="${cert.specialty || ''}">
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <span class="view-mode">${statusBadge}</span>
        <select class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          <option value="Active" ${cert.status === 'Active' ? 'selected' : ''}>Active</option>
          <option value="Pending" ${cert.status === 'Pending' ? 'selected' : ''}>Pending</option>
          <option value="Expired" ${cert.status === 'Expired' ? 'selected' : ''}>Expired</option>
          <option value="Revoked" ${cert.status === 'Revoked' ? 'selected' : ''}>Revoked</option>
        </select>
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <span class="view-mode">
          ${cert.tags ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
            <i class="fas fa-tag mr-1"></i>${cert.tags}
          </span>` : '<span class="text-gray-400 text-sm">No tags</span>'}
        </span>
        <input type="text" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="${cert.tags || ''}">
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        <span class="view-mode">
          <div class="flex items-center">
            <i class="fas fa-calendar-alt text-gray-400 mr-2"></i>
            <span class="text-sm text-gray-900">${cert.expiration_date}</span>
          </div>
        </span>
        <input type="date" class="edit-mode hidden w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" value="${cert.expiration_date}">
      </td>
      {% if session.user.role == 'admin' %}
      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
        <div class="view-mode flex items-center gap-2">
          <button onclick="toggleEditMode('${cert.id}')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 transition-colors">
            <i class="fas fa-edit mr-1"></i>Edit
          </button>
          <form method="POST" action="/radmapping/doctors/${cert.radiologist_id}/licenses/${cert.id}/delete" class="inline">
            <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 transition-colors">
              <i class="fas fa-trash mr-1"></i>Delete
            </button>
          </form>
        </div>
        <div class="edit-mode hidden flex items-center gap-2">
          <button onclick="saveLicense('${cert.id}')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 transition-colors">
            <i class="fas fa-save mr-1"></i>
          </button>
          <button onclick="cancelEdit('${cert.id}')" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors">
            <i class="fas fa-times mr-1"></i>
          </button>
        </div>
      </td>
      {% endif %}
    `;
    
    tbody.appendChild(row);
  });
}

function updatePagination(total) {
  totalCount = total;
  const totalPages = Math.ceil(totalCount / itemsPerPage);
  const startItem = ((currentPage - 1) * itemsPerPage) + 1;
  const endItem = Math.min(currentPage * itemsPerPage, totalCount);

  document.getElementById('startItem').textContent = startItem;
  document.getElementById('endItem').textContent = endItem;
  document.getElementById('totalItems').textContent = totalCount;

  document.getElementById('prevPage').disabled = currentPage === 1;
  document.getElementById('nextPage').disabled = currentPage === totalPages;
}

function changePage(direction) {
  const totalPages = Math.ceil(totalCount / itemsPerPage);
  
  if (direction === 'next' && currentPage < totalPages) {
    currentPage++;
  } else if (direction === 'prev' && currentPage > 1) {
    currentPage--;
  }
  
  loadLicenses();
}

function filterByStatus(status) {
  currentStatusFilter = status;
  
  // Update button styles
  document.querySelectorAll('[data-status]').forEach(button => {
    button.classList.remove('active-filter', 'bg-blue-600', 'text-white');
    button.classList.add('bg-gray-100', 'text-gray-700');
    if (button.dataset.status === status) {
      button.classList.remove('bg-gray-100', 'text-gray-700');
      button.classList.add('active-filter', 'bg-blue-600', 'text-white');
    }
  });
  
  currentPage = 1;
  loadLicenses();
}

function toggleEditMode(licenseId) {
  const row = document.getElementById(`license-row-${licenseId}`);
  row.querySelectorAll('.view-mode').forEach(el => el.classList.add('hidden'));
  row.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('hidden'));
}

function cancelEdit(licenseId) {
  const row = document.getElementById(`license-row-${licenseId}`);
  row.querySelectorAll('.edit-mode').forEach(el => el.classList.add('hidden'));
  row.querySelectorAll('.view-mode').forEach(el => el.classList.remove('hidden'));
}

function saveLicense(licenseId) {
  const row = document.getElementById(`license-row-${licenseId}`);
  const formData = new FormData();
  
  formData.append('radiologist_id', row.querySelector('select').value);
  formData.append('state', row.querySelector('input[type="text"]').value);
  formData.append('specialty', row.querySelectorAll('input[type="text"]')[1].value);
  formData.append('status', row.querySelectorAll('select')[1].value);
  formData.append('tags', row.querySelectorAll('input[type="text"]')[2].value);
  formData.append('expiration_date', row.querySelector('input[type="date"]').value);

  fetch(`/radmapping/licenses/${licenseId}/update`, {
    method: 'POST',
    body: formData
  }).then(() => {
    loadLicenses();
  });
}
</script>
{% endblock %}