{% extends "layout.html" %}
{% block title %}License{% endblock %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">License</h2>

<!-- Query Section -->
<div class="mb-6">
  <label class="block text-md font-medium mb-2">Query</label>
  <input type="text" id="licenseQuery" placeholder="Type in your license query here..." value="{{ query }}" class="w-full p-3 border rounded text-sm mb-4" />
  <div id="queryResult" class="bg-gray-50 border rounded p-6 text-gray-600 text-lg mb-4">
    This container will contain the answer to your query
  </div>
</div>

<!-- License Table -->
<div class="mb-8">
  <h3 class="text-lg font-semibold mb-2">All Licenses</h3>
  <div class="overflow-x-auto">
    <table id="licenseTable" class="min-w-full border text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 border">Doctor</th>
          <th class="px-4 py-2 border">State</th>
          <th class="px-4 py-2 border">Exp</th>
        </tr>
      </thead>
      <tbody>
        {% for cert in certifications %}
        <tr class="hover:bg-gray-50 license-row">
          <td class="px-4 py-2 border doctor-cell">{{ cert.radiologists.name if cert.radiologists else 'â€”' }}</td>
          <td class="px-4 py-2 border state-cell">{{ cert.state }}</td>
          <td class="px-4 py-2 border exp-cell">{{ cert.expiration_date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Add License Form -->
<div class="mt-8">
  <h3 class="text-lg font-semibold mb-2">Add License</h3>
  <form method="POST" class="space-y-3 max-w-md">
    <select name="doctor" required class="w-full p-3 border rounded text-sm">
      <option value="">Select Doctor</option>
      {% for doc in radiologists %}
        <option value="{{ doc.id }}">{{ doc.name }}</option>
      {% endfor %}
    </select>
    <input type="text" name="state" placeholder="State" required class="w-full p-3 border rounded text-sm" />
    <input type="date" name="exp" placeholder="Exp" required class="w-full p-3 border rounded text-sm" />
    <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded font-semibold">Add License</button>
  </form>
</div>

<script>
// Live filter for license table and result container
const queryInput = document.getElementById('licenseQuery');
const tableRows = Array.from(document.querySelectorAll('.license-row'));
const resultBox = document.getElementById('queryResult');

function filterLicenses() {
  const q = queryInput.value.toLowerCase();
  let found = 0;
  tableRows.forEach(row => {
    const doctor = row.querySelector('.doctor-cell').textContent.toLowerCase();
    const state = row.querySelector('.state-cell').textContent.toLowerCase();
    const exp = row.querySelector('.exp-cell').textContent.toLowerCase();
    const match = doctor.includes(q) || state.includes(q) || exp.includes(q);
    row.style.display = match ? '' : 'none';
    if (match) found++;
  });
  if (q.length > 0) {
    resultBox.textContent = found > 0 ? `${found} result(s) found.` : 'No results found.';
  } else {
    resultBox.textContent = 'This container will contain the answer to your query';
  }
}
queryInput.addEventListener('input', filterLicenses);
window.addEventListener('DOMContentLoaded', filterLicenses);
</script>
{% endblock %} 