{% extends "layout.html" %}
{% block title %}General Information{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="mb-8">
        <div class="flex items-center justify-between flex-wrap gap-4 mb-4">
            <div class="flex items-center">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center mr-4">
                    <i class="fas fa-info-circle text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">General Information</h1>
                    <p class="text-gray-600">Important information and guidelines for the radiology department</p>
                </div>
            </div>
            {% if session.user.role == 'admin' %}
            <button onclick="openAddModal()" 
                    class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-medium rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200">
                <i class="fas fa-plus mr-2"></i>
                Add New Article
            </button>
            {% endif %}
        </div>
        
        <div class="relative max-w-md">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-search text-gray-400"></i>
            </div>
            <input type="text" 
                   id="infoSearch" 
                   placeholder="Search information and guidelines..." 
                   class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors shadow-sm"
                   onkeyup="filterInfo()">
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" id="infoSections">
        {% for article in articles %}
        <section class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow info-article" data-id="{{ article.id }}" data-title="{{ article.title }}" data-content="{{ article.content }}" data-category="{{ article.category }}" data-theme="{{ article.theme }}" data-icon="{{ article.icon }}">
            <div class="flex items-start mb-4 justify-between">
                <div class="flex items-start">
                    {% set icon_class = article.icon %}
                    {% set theme = article.theme %}
                    
                    {% set icon_theme = 'bg-blue-100 to-blue-100 text-blue-600' %}
                    {% set content_bg = 'bg-blue-50' %}
                    {% set content_border = 'border-blue-400' %}

                    {% if theme == 'purple-blue' %}
                        {% set icon_theme = 'from-purple-100 to-blue-100 text-purple-600' %}
                        {% set content_bg = 'bg-purple-50' %}
                        {% set content_border = 'border-purple-400' %}
                    {% elif theme == 'orange-red' %}
                        {% set icon_theme = 'from-orange-100 to-red-100 text-orange-600' %}
                        {% set content_bg = 'bg-orange-50' %}
                        {% set content_border = 'border-orange-400' %}
                    {% elif theme == 'green-emerald' %}
                        {% set icon_theme = 'from-green-100 to-emerald-100 text-green-600' %}
                        {% set content_bg = 'bg-green-50' %}
                        {% set content_border = 'border-green-400' %}
                    {% elif theme == 'indigo-purple' %}
                        {% set icon_theme = 'from-indigo-100 to-purple-100 text-indigo-600' %}
                        {% set content_bg = 'bg-indigo-50' %}
                        {% set content_border = 'border-indigo-400' %}
                    {% elif theme == 'teal-cyan' %}
                        {% set icon_theme = 'from-teal-100 to-cyan-100 text-teal-600' %}
                        {% set content_bg = 'bg-teal-50' %}
                        {% set content_border = 'border-teal-400' %}
                    {% elif theme == 'pink-rose' %}
                        {% set icon_theme = 'from-pink-100 to-rose-100 text-pink-600' %}
                        {% set content_bg = 'bg-pink-50' %}
                        {% set content_border = 'border-pink-400' %}
                    {% elif theme == 'amber-yellow' %}
                        {% set icon_theme = 'from-amber-100 to-yellow-100 text-amber-600' %}
                        {% set content_bg = 'bg-amber-50' %}
                        {% set content_border = 'border-amber-400' %}
                    {% elif theme == 'red-pink' %}
                        {% set icon_theme = 'from-red-100 to-pink-100 text-red-600' %}
                        {% set content_bg = 'bg-red-50' %}
                        {% set content_border = 'border-red-400' %}
                    {% endif %}
                    
                    <div class="w-10 h-10 bg-gradient-to-r {{ icon_theme }} rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                        <i class="{{ icon_class }}"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900">{{ article.title }}</h2>
                        <span class="text-xs text-gray-500">{{ article.category }}</span>
                    </div>
                </div>
                {% if session.user.role == 'admin' %}
                <div class="flex-shrink-0 flex space-x-2">
                    <button onclick="openEditModal(this)"
                            class="text-blue-600 hover:text-blue-800 transition-colors">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="openDeleteModal(this)"
                            data-id="{{ article.id }}"
                            data-title="{{ article.title }}"
                            class="text-red-600 hover:text-red-800 transition-colors">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                {% endif %}
            </div>
            <div class="prose prose-gray max-w-none">
                <div class="{{ content_bg }} border-l-4 {{ content_border }} p-4 rounded-r-lg">
                    <p class="text-gray-700 leading-relaxed" style="white-space: pre-wrap;">{{ article.content }}</p>
                </div>
            </div>
        </section>
        {% else %}
        <div class="col-span-full text-center py-12">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-folder-open text-gray-400 text-xl"></i>
            </div>
            <p class="text-gray-500 font-medium">No articles found</p>
            <p class="text-gray-400 text-sm">Add a new article to get started</p>
        </div>
        {% endfor %}
    </div>
</div>

<div id="addModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4" onclick="if(event.target === this) closeAddModal();">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto transform transition-all" onclick="event.stopPropagation();">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Add New Article</h3>
            <button onclick="closeAddModal()" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form method="POST" action="{{ url_for('info.add_article') }}" class="p-6 space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                <input type="text" name="title" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                <input type="text" name="category" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Color Theme</label>
                <select name="theme" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    {% for theme in available_themes %}
                    <option value="{{ theme }}">{{ theme }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Icon</label>
                <select name="icon" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    {% for icon in available_icons %}
                    <option value="{{ icon }}">{{ icon }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                <textarea name="content" rows="6" required class="w-full px-4 py-3 border border-gray-300 rounded-lg resize-none"></textarea>
            </div>
            <div class="flex justify-end gap-3 pt-2">
                <button type="button" onclick="closeAddModal()" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg">Add Article</button>
            </div>
        </form>
    </div>
</div>

<div id="editModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4" onclick="if(event.target === this) closeEditModal();">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl max-h-[90vh] overflow-y-auto transform transition-all" onclick="event.stopPropagation();">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Edit Article</h3>
            <button onclick="closeEditModal()" class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="editForm" method="POST" class="p-6 space-y-4">
            <input type="hidden" name="id" id="editArticleId">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                <input type="text" name="title" id="editTitle" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                <input type="text" name="category" id="editCategory" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Color Theme</label>
                <select name="theme" id="editTheme" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    {% for theme in available_themes %}
                    <option value="{{ theme }}">{{ theme }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Icon</label>
                <select name="icon" id="editIcon" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                    {% for icon in available_icons %}
                    <option value="{{ icon }}">{{ icon }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Content</label>
                <textarea name="content" id="editContent" rows="6" required class="w-full px-4 py-3 border border-gray-300 rounded-lg resize-none"></textarea>
            </div>
            <div class="flex justify-end gap-3 pt-2">
                <button type="button" onclick="closeEditModal()" class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg">Save Changes</button>
            </div>
        </form>
    </div>
</div>

</div>


<div id="delete-confirm-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all" onclick="event.stopPropagation();">
    <div class="flex items-center gap-4 p-6 border-b border-gray-200">
      <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-red-100 text-red-600 rounded-lg text-xl">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3 class="text-lg font-semibold text-gray-900">Delete Article</h3>
      <button onclick="closeDeleteModal()" class="ml-auto p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
          <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="p-6">
            <div class="body-text">
                <p class="text-gray-900 font-medium">Are you sure you want to delete this article?</p>
                <p class="text-gray-600 text-sm mt-1">This action cannot be undone.</p>
                <div id="item-to-delete-info" class="bg-red-50 border-l-4 border-red-400 text-red-800 p-3 rounded-r-lg font-medium">
                 </div>
            </div>
                    </form>
    </div>
    <div class="flex justify-end gap-3 p-6 bg-gray-50 rounded-b-xl">
      <button onclick="closeDeleteModal()" class="px-4 py-2 text-gray-700 bg-gray-200 hover:bg-gray-300 rounded-lg font-medium">Cancel</button>
      <button id="confirm-delete-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium inline-flex items-center">
        <i class="fas fa-trash-alt mr-2"></i>Delete Article
      </button>
    </div>
  </div>
</div>


<script>
    function openAddModal() {
        document.getElementById('addModal').classList.remove('hidden');
    }

    function closeAddModal() {
        document.getElementById('addModal').classList.add('hidden');
    }

    function openEditModal(button) {
        const article = button.closest('.info-article');
        const id = article.dataset.id;
        const title = article.dataset.title;
        const content = article.dataset.content;
        const category = article.dataset.category;
        const theme = article.dataset.theme;
        const icon = article.dataset.icon;
        
        const editForm = document.getElementById('editForm');
        editForm.action = `/radmapping/info/${id}/edit`;
        document.getElementById('editArticleId').value = id;
        document.getElementById('editTitle').value = title;
        document.getElementById('editContent').value = content;
        document.getElementById('editCategory').value = category;
        document.getElementById('editTheme').value = theme;
        document.getElementById('editIcon').value = icon;
        document.getElementById('editModal').classList.remove('hidden');
    }

    function closeEditModal() {
        document.getElementById('editModal').classList.add('hidden');
    }

       const deleteModal = document.getElementById('delete-confirm-modal');
    const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
    const infoBox = document.getElementById('item-to-delete-info');

    let articleIdToDelete = null;

    function openDeleteModal(button) {
        articleIdToDelete = button.dataset.id;
        const articleTitle = button.dataset.title;

        infoBox.textContent = `Article: "${articleTitle}"`;
        deleteModal.classList.remove('hidden');
    }

    function closeDeleteModal() {
        deleteModal.classList.add('hidden');
        articleIdToDelete = null; 
    }

    confirmDeleteBtn.addEventListener('click', () => {
        if (articleIdToDelete) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/radmapping/info/${articleIdToDelete}/delete`;
            document.body.appendChild(form);
            form.submit();
        }
    });

    deleteModal.addEventListener('click', (event) => {
        if (event.target === deleteModal) {
            closeDeleteModal();
        }
    });


    function filterInfo() {
        const searchTerm = document.getElementById('infoSearch').value.toLowerCase();
        const articles = document.querySelectorAll('.info-article');
        let visibleCount = 0;
        articles.forEach(article => {
            const title = article.dataset.title.toLowerCase();
            const content = article.dataset.content.toLowerCase();
            const category = article.dataset.category.toLowerCase();
            if (title.includes(searchTerm) || content.includes(searchTerm) || category.includes(searchTerm)) {
                article.style.display = 'block';
                visibleCount++;
            } else {
                article.style.display = 'none';
            }
        });

        const noResultsDiv = document.getElementById('no-results');
        if (visibleCount === 0) {
            if (!noResultsDiv) {
                const noResults = document.createElement('div');
                noResults.id = 'no-results';
                noResults.className = 'col-span-full text-center py-12';
                noResults.innerHTML = `
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-search text-gray-400 text-xl"></i>
                    </div>
                    <p class="text-gray-500 font-medium">No articles found</p>
                    <p class="text-gray-400 text-sm">Try searching with different keywords</p>
                `;
                document.getElementById('infoSections').appendChild(noResults);
            }
        } else if (noResultsDiv) {
            noResultsDiv.remove();
        }
    }
</script>
{% endblock %}