<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}RadMapping+{% endblock %}</title>
   <script src="https://cdn.tailwindcss.com"></script>
  <script>
  tailwind.config = { darkMode: ['class', '[data-theme="dark"]'] }
</script>

 
  <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/x-icon">
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script>
    (function() {
      try {
        const storedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = storedTheme || (prefersDark ? 'dark' : 'light');
        if (theme) {
          document.documentElement.setAttribute('data-theme', theme);
        }
      } catch (error) {
        document.documentElement.setAttribute('data-theme', 'light');
      }
    })();
  </script>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 text-gray-800 overflow-x-hidden">
<div class="dashboard-container relative min-h-screen">
  <div class="relative z-10 {% if request.endpoint == 'landing.landing' %}h-screen flex flex-col{% endif %}">
    {% if session.user and request.endpoint != 'auth.login' %}
    <div class="navbar-wrapper">
      <nav class="navbar-enhanced {% if request.endpoint == 'landing.landing' %}flex-shrink-0{% endif %}">
        <div class="navbar-gradient"></div>
        
        <div class="navbar-glass"></div>
        
        <div class="max-w-[115rem] mx-auto px-4 relative z-10">
          <div class="flex h-14 items-center justify-between">
            <div class="flex-shrink-0">
              <a href="{{ url_for('landing.landing') }}" class="navbar-logo-minimal group">
                <div class="logo-icon-minimal">
                  <i class="fas fa-heartbeat"></i>
                </div>
              </a>
            </div>

            <div class="hidden lg:flex items-center space-x-3">
              {% set routes = [
                {'endpoint': 'daily.daily', 'label': 'Daily Schedule'},
                {'endpoint': 'monthly.monthly', 'label': 'Monthly Schedule'},
                {'endpoint': 'shifts.shifts', 'label': 'Capacity'},
                {'endpoint': 'doctors.doctor_list', 'label': 'Doctors'},
                {'endpoint': 'facilities.facilities', 'label': 'Facilities'},
                {'endpoint': 'specialties.specialties', 'label': 'Exam Types'},
                {'endpoint': 'licenses.licenses_page', 'label': 'Licenses'},
                {'endpoint': 'vacations.vacations_page', 'label': 'Vacations'},
                {'endpoint': 'info.info', 'label': 'Information'},
                {'endpoint': 'contacts.contacts', 'label': 'Contacts'},
                {'endpoint': 'audit.view_audit_log', 'label': 'Audit Log'}
              ] %}
              
              {% for route in routes %}
              <a href="{{ url_for(route.endpoint) }}" 
                 class="nav-item-minimal {% if request.endpoint == route.endpoint %}nav-item-active-minimal{% endif %}">
                <span class="nav-text-minimal">{{ route.label }}</span>
                <div class="nav-indicator-minimal"></div>
              </a>
              {% endfor %}
            </div>

            <div class="lg:hidden">
              <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
              </button>
            </div>

            <div class="flex-shrink-0">
              {% set user = session.user %}
              {% if user %}
              {% if user.name %}
                {% set display_name = user.name %}
              {% elif user.email %}
                {% set display_name = user.email.split('@')[0] %}
              {% else %}
                {% set display_name = 'User' %}
              {% endif %}
              {% set avatar_url = user.avatar_url %}
              {% else %}
                {% set display_name = 'User' %}
                {% set avatar_url = None %}
              {% endif %}
              <div class="user-section user-menu" id="userMenu">
                <button type="button" id="userMenuButton" class="user-avatar-button" aria-haspopup="true" aria-expanded="false" aria-label="Open user menu" title="{{ display_name }}">
                  {% if avatar_url %}
                    <img src="{{ avatar_url }}" alt="{{ display_name }} avatar" class="user-avatar-image" referrerpolicy="no-referrer">
                  {% else %}
                    <span class="user-avatar-fallback">{{ display_name[0]|upper }}</span>
                  {% endif %}
                </button>
                <div class="user-dropdown" id="userDropdown" role="menu" aria-labelledby="userMenuButton">
                  <div class="user-dropdown-header">
                    <span class="user-dropdown-name">{{ display_name }}</span>
                    {% if user and user.email %}
                    <span class="user-dropdown-email">{{ user.email }}</span>
                    {% endif %}
                  </div>
                  <button type="button" id="theme-toggle" class="user-dropdown-item" role="menuitem">
                    Switch to <i class="fas fa-moon"></i>
                  </button>
                  <a href="{{ url_for('auth.logout') }}" class="user-dropdown-item" role="menuitem">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mobile-menu" id="mobileMenu">
          <div class="mobile-menu-content">
            {% for route in routes %}
            <a href="{{ url_for(route.endpoint) }}" 
               class="mobile-nav-item {% if request.endpoint == route.endpoint %}mobile-nav-active{% endif %}">
              <span>{{ route.label }}</span>
            </a>
            {% endfor %}
          </div>
        </div>
      </nav>
    </div>
    {% endif %}

    {% if request.endpoint == 'auth.login' %}
      {% block login_content %}{% endblock %}
    {% else %}
      {% if request.endpoint == 'landing.landing' %}
        <div class="flex-1 overflow-hidden">
      {% else %}
        <div class="max-w-[115rem] mx-auto px-6 py-8 mt-6 bg-white rounded shadow">

      {% endif %}
          {% block content %}{% endblock %}
        </div>
    {% endif %}

    <!-- {% if session.user %}
      {% include 'chatbot.html' %}
    {% endif %} -->
  </div>

{% if request.endpoint == 'landing.landing' %}
</div>
{% endif %}

<script>
function toggleMobileMenu() {
  const menu = document.getElementById('mobileMenu');
  const btn = document.querySelector('.mobile-menu-btn');
  
  menu.classList.toggle('mobile-menu-open');
  btn.classList.toggle('hamburger-active');
}

document.addEventListener('click', function(event) {
  const menu = document.getElementById('mobileMenu');
  const btn = document.querySelector('.mobile-menu-btn');
  
  if (!menu.contains(event.target) && !btn.contains(event.target)) {
    menu.classList.remove('mobile-menu-open');
    btn.classList.remove('hamburger-active');
  }
});

document.addEventListener('DOMContentLoaded', function() {
  const root = document.documentElement;
  const themeToggle = document.getElementById('theme-toggle');
  const userMenuButton = document.getElementById('userMenuButton');
  const userDropdown = document.getElementById('userDropdown');

  const applyTheme = function(theme) {
    root.setAttribute('data-theme', theme);
    try {
      localStorage.setItem('theme', theme);
    } catch (error) {
      /* localStorage might be unavailable */
    }

    if (themeToggle) {
      const nextLabel = theme === 'dark' ? 'light' : 'dark';
      themeToggle.setAttribute('aria-pressed', theme === 'dark');
      themeToggle.setAttribute('title', 'Switch to ' + nextLabel + ' mode');
      themeToggle.setAttribute('aria-label', 'Switch to ' + nextLabel + ' mode');
      themeToggle.innerHTML = theme === 'dark'
        ? 'Switch to <i class="fas fa-sun"></i>'
        : 'Switch to <i class="fas fa-moon"></i>';
    }

    document.dispatchEvent(new CustomEvent('themechange', { detail: { theme } }));
  };

  const storedTheme = (function() {
    try {
      return localStorage.getItem('theme');
    } catch (error) {
      return null;
    }
  })();

  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const initialTheme = storedTheme || root.getAttribute('data-theme') || (prefersDark ? 'dark' : 'light');

  applyTheme(initialTheme);

  if (themeToggle) {
    themeToggle.addEventListener('click', function() {
      const nextTheme = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      applyTheme(nextTheme);
    });
  }

  if (userMenuButton && userDropdown) {
    const focusableItems = userDropdown.querySelectorAll('.user-dropdown-item');

    const setMenuState = function(open) {
      userDropdown.classList.toggle('user-dropdown-open', open);
      userMenuButton.setAttribute('aria-expanded', open ? 'true' : 'false');
      if (open && focusableItems.length > 0) {
        window.requestAnimationFrame(function() {
          focusableItems[0].focus();
        });
      }
    };

    userMenuButton.addEventListener('click', function(event) {
      event.stopPropagation();
      const isOpen = userDropdown.classList.contains('user-dropdown-open');
      setMenuState(!isOpen);
    });

    userMenuButton.addEventListener('keydown', function(event) {
      if (event.key === 'ArrowDown' || event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        setMenuState(true);
      }
      if (event.key === 'Escape') {
        setMenuState(false);
      }
    });

    const handleDocumentClick = function(event) {
      if (!userDropdown.contains(event.target) && !userMenuButton.contains(event.target)) {
        setMenuState(false);
      }
    };

    document.addEventListener('click', handleDocumentClick);

    userDropdown.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        setMenuState(false);
        userMenuButton.focus();
      }
    });

    userDropdown.addEventListener('click', function(event) {
      const target = event.target.closest('.user-dropdown-item');
      if (target) {
        setMenuState(false);
        if (target.id === 'theme-toggle') {
          userMenuButton.focus();
        }
      }
    });
  }
});
</script>

</body>
</html>
