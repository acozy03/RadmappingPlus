{% extends "layout.html" %}
{% block title %}{{ facility.name }}{% endblock %}

{% block content %}
<div x-data="{ editing: false }">
  <div class="mb-8">
    <div class="bg-white rounded-lg shadow p-6 border flex flex-col sm:flex-row items-center justify-between gap-4">
      <h2 class="text-3xl font-bold text-blue-800 text-center sm:text-left mb-2 sm:mb-0 flex-1">{{ facility.name }}</h2>
      {% if session.user.role == 'admin' %}
        <button @click="editing = !editing" class="inline-flex items-center gap-2 px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition text-base font-semibold focus:outline-none focus:ring-2 focus:ring-blue-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5h2m-1 0v14m-7-7h14" /></svg>
          <span x-show="!editing">Edit Info</span>
          <span x-show="editing">Cancel Edit</span>
        </button>
      {% endif %}
    </div>
  </div>

  <div x-show="!editing" class="mb-8">
    <div class="bg-white rounded-lg shadow p-6 border grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div class="flex items-center space-x-3">
        <span class="inline-flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-600 rounded-full text-lg">üìç</span>
        <div>
          <div class="text-xs text-gray-500 font-semibold uppercase">Location</div>
          <div class="text-base font-medium text-gray-900">{{ facility.location }}</div>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <span class="inline-flex items-center justify-center w-8 h-8 bg-purple-100 text-purple-600 rounded-full text-lg">üíæ</span>
        <div>
          <div class="text-xs text-gray-500 font-semibold uppercase">PACS</div>
          <div class="text-base font-medium text-gray-900">{{ facility.pacs }}</div>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <span class="inline-flex items-center justify-center w-8 h-8 bg-yellow-100 text-yellow-600 rounded-full text-lg">‚è±Ô∏è</span>
        <div>
          <div class="text-xs text-gray-500 font-semibold uppercase">TAT Definition</div>
          <div class="text-base font-medium text-gray-900">{{ facility.tat_definition }}</div>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <span class="inline-flex items-center justify-center w-8 h-8 bg-pink-100 text-pink-600 rounded-full text-lg">üß¨</span>
        <div>
          <div class="text-xs text-gray-500 font-semibold uppercase">Assignment Period</div>
          <div class="text-base font-medium text-gray-900">{{ facility.modalities_assignment_period }}</div>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <span class="inline-flex items-center justify-center w-8 h-8 bg-pink-100 text-pink-600 rounded-full text-lg">üî¢</span>
        <div>
          <div class="text-xs text-gray-500 font-semibold uppercase">Assignment Type</div>
          <div class="text-base font-medium text-gray-900">{{ facility.modalities or '' }}</div>
        </div>
      </div>
      <div class="flex items-center space-x-3">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full text-lg
          {% if facility.active_status == 'true' %}bg-green-100 text-green-600{% else %}bg-red-100 text-red-600{% endif %}">
          {% if facility.active_status == 'true' %}‚úÖ{% else %}‚ùå{% endif %}
        </span>
        <div>
          <div class="text-xs text-gray-500 font-semibold uppercase">Status</div>
          <div class="text-base font-medium {% if facility.active_status == 'true' %}text-green-700{% else %}text-red-700{% endif %}">
            {% if facility.active_status == 'true' %}Active{% else %}Inactive{% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div x-show="editing" class="mb-8">
    <form method="POST" action="{{ url_for('dashboard.update_facility', facility_id=facility.id) }}" class="bg-white rounded-lg shadow p-6 border grid grid-cols-1 sm:grid-cols-2 gap-6">
      <label class="block">
        <span class="font-semibold">Location</span>
        <input type="text" name="location" value="{{ facility.location or '' }}" class="input w-full border rounded px-3 py-2 text-sm" />
      </label>
      <label class="block">
        <span class="font-semibold">PACS</span>
        <input type="text" name="pacs" value="{{ facility.pacs or '' }}" class="input w-full border rounded px-3 py-2 text-sm" />
      </label>
      <label class="block">
        <span class="font-semibold">TAT Definition</span>
        <input type="text" name="tat_definition" value="{{ facility.tat_definition or '' }}" class="input w-full border rounded px-3 py-2 text-sm" />
      </label>
      <label class="block">
        <span class="font-semibold">Assignment Period</span>
        <input type="text" name="assignment_period" value="{{ facility.modalities_assignment_period or '' }}" class="input w-full border rounded px-3 py-2 text-sm" />
      </label>
      <label class="block">
        <span class="font-semibold">Assignment Type</span>
        <input type="text" name="assignment_type" value="{{ facility.modalities or '' }}" class="input w-full border rounded px-3 py-2 text-sm" />
      </label>
      <label class="flex items-center space-x-2 mt-4">
        <input type="checkbox" name="active_status" value="true" {% if facility.active_status == 'true' %}checked{% endif %} class="form-checkbox h-5 w-5 text-blue-600">
        <span class="text-sm font-medium">Active</span>
      </label>
      <div class="col-span-2">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded text-sm font-semibold mt-2">
          Save Changes
        </button>
      </div>
    </form>
  </div>
</div>

<div class="flex flex-col md:flex-row gap-8 mt-8">
  <!-- Facility Contacts Card -->
  <div class="flex-1 min-w-0">
    <div class="bg-white rounded-lg shadow p-6 border h-full flex flex-col">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-semibold">Facility Contacts</h3>
        {% if session.user.role == 'admin' %}
          <button onclick="openAddContactModal()" class="bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-blue-700">Add Contact</button>
        {% endif %}
      </div>
      {% if facility_contacts %}
        <div class="grid grid-cols-1 gap-4">
          {% for contact in facility_contacts %}
            <div class="border rounded-lg shadow-sm bg-gray-50 p-4 contact-item flex flex-col h-full">
              <p class="text-blue-600 font-bold text-xl mb-3 pb-2 border-b">{{ contact.role }}</p>
              <div class="space-y-2 flex-grow">
                <p><strong>Name:</strong> <span class="searchable">{{ contact.contact_name }}</span></p>
                <p><strong>Email:</strong> <a href="mailto:{{ contact.email }}" class="text-blue-600 hover:underline searchable">{{ contact.email }}</a></p>
                <p><strong>Phone:</strong> <span class="searchable">{{ contact.phone }}</span></p>
              </div>
              <div class="mt-3 pt-3 border-t flex items-center justify-between">
                <button onclick="toggleContactDetails('{{ contact.id }}')" class="text-blue-600 text-sm hover:underline">View Details</button>
                {% if session.user.role == 'admin' %}
                  <div class="flex gap-2">
                    <button onclick="editContact({{ contact|tojson|safe }})" class="bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200">Edit</button>
                    <button onclick="deleteContact('{{ contact.id }}', '{{ facility.id }}')" class="bg-red-100 text-red-700 px-3 py-1 rounded hover:bg-red-200">Delete</button>
                  </div>
                {% endif %}
              </div>
              <div id="details-{{ contact.id }}" class="hidden mt-2 pt-2 border-t">
                <p><strong>Comments:</strong></p>
                <div class="whitespace-pre-line mt-2 text-sm">{{ contact.comments or "‚Äî" }}</div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-500 italic">No contacts available for this facility.</p>
      {% endif %}
    </div>
  </div>
  <!-- Assigned Radiologists Card -->
  <div class="flex-1 min-w-0">
    <div class="bg-white rounded-lg shadow p-6 border h-full flex flex-col">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2">
        <h3 class="text-lg font-semibold">Assigned Radiologists</h3>
        <div class="flex items-center gap-2 w-full sm:w-auto">
          <div class="relative w-full sm:w-64">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400 pointer-events-none">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            </span>
            <input type="text" class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-200 focus:border-blue-400 text-sm w-full bg-gray-50" placeholder="Search radiologists..." disabled />
          </div>
          {% if session.user.role == 'admin' %}
            <button type="button" onclick="openRadiologistModal()" class="bg-blue-600 text-white px-4 py-2 rounded text-sm font-medium hover:bg-blue-700 whitespace-nowrap">Assign Radiologists</button>
            <button type="button" onclick="openBulkEditAssignmentsModal()" class="bg-yellow-500 text-white px-4 py-2 rounded text-sm font-medium hover:bg-yellow-600 whitespace-nowrap">Edit Assignments</button>
          {% endif %}
        </div>
      </div>
      {% if doctor_assignments %}
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white border border-gray-200 text-sm rounded">
            <thead class="bg-gray-100">
              <tr class="text-left">
                <th class="px-4 py-2 border-b">Name</th>
                <th class="px-4 py-2 border-b">Can Read</th>
                <th class="px-4 py-2 border-b">Does Stats</th>
                <th class="px-4 py-2 border-b">Does Routines</th>
                <th class="px-4 py-2 border-b">Stipulations</th>
                <th class="px-4 py-2 border-b">Notes</th>
              </tr>
            </thead>
            <tbody>
              {% for assignment in doctor_assignments %}
              <tr class="hover:bg-blue-50">
                <td class="px-4 py-2 border-b">
                  <a href="{{ url_for('dashboard.doctor_profile', rad_id=assignment.radiologists.id) }}"
                     class="text-blue-700 hover:underline">
                    {{ assignment.radiologists.name }}
                  </a>
                </td>
                <td class="px-4 py-2 border-b">{{ "‚úÖ" if assignment.can_read else "‚ùå" }}</td>
                <td class="px-4 py-2 border-b">{{ "‚úÖ" if assignment.does_stats else "‚ùå" }}</td>
                <td class="px-4 py-2 border-b">{{ "‚úÖ" if assignment.does_routines else "‚ùå" }}</td>
                <td class="px-4 py-2 border-b">{{ assignment.stipulations or "‚Äî" }}</td>
                <td class="px-4 py-2 border-b">{{ assignment.notes or "‚Äî" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-gray-500 italic">No doctors assigned.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- Add Contact Modal -->
<div id="addContactModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-lg shadow-lg w-[90%] max-w-xl max-h-[80vh] overflow-y-auto p-6 relative">
    <button onclick="closeAddContactModal()" class="absolute top-2 right-2 text-2xl font-bold text-gray-500 hover:text-black">√ó</button>
    <h3 class="text-xl font-semibold mb-4">Add New Contact</h3>
    
    <form method="POST" action="{{ url_for('dashboard.add_facility_contact', facility_id=facility.id) }}" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Role</label>
        <input type="text" name="role" required class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm ">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Name</label>
        <input type="text" name="contact_name" required class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" name="email" class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Phone</label>
        <input type="tel" name="phone" class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Comments</label>
        <textarea name="comments" rows="3" class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm"></textarea>
      </div>
      
      <div class="flex justify-end gap-3">
        <button type="button" onclick="closeAddContactModal()" class="px-4 py-2 text-sm border rounded text-gray-700 hover:bg-gray-50">Cancel</button>
        <button type="submit" class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">Add Contact</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Contact Modal -->
<div id="editContactModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-lg shadow-lg w-[90%] max-w-xl max-h-[80vh] overflow-y-auto p-6 relative">
    <button onclick="closeEditContactModal()" class="absolute top-2 right-2 text-2xl font-bold text-gray-500 hover:text-black">√ó</button>
    <h3 class="text-xl font-semibold mb-4">Edit Contact</h3>
    
    <form id="editContactForm" method="POST" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Role</label>
        <input type="text" name="role" required class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm bg-blue-50">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Name</label>
        <input type="text" name="contact_name" required class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Email</label>
        <input type="email" name="email" class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Phone</label>
        <input type="tel" name="phone" class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700">Comments</label>
        <textarea name="comments" rows="3" class="mt-1 block w-full border rounded-md shadow-sm py-2 px-3 text-sm"></textarea>
      </div>
      
      <div class="flex justify-end gap-3">
        <button type="button" onclick="closeEditContactModal()" class="px-4 py-2 text-sm border rounded text-gray-700 hover:bg-gray-50">Cancel</button>
        <button type="submit" class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- Radiologist Assignment Modal -->
<div id="radiologistModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-lg shadow-lg w-[90%] max-w-2xl max-h-[80vh] overflow-y-auto p-6 relative">
    <button onclick="closeRadiologistModal()" class="absolute top-2 right-2 text-2xl font-bold text-gray-500 hover:text-black">√ó</button>
    <h3 class="text-xl font-semibold mb-4">Assign Radiologist to Facility</h3>
    <form method="POST" action="{{ url_for('dashboard.assign_radiologist', facility_id=facility.id) }}" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Select Radiologist</label>
        <select name="radiologist_id" required class="w-full border rounded px-3 py-2 text-sm">
          <option value="">Choose a radiologist...</option>
          {% for rad in available_radiologists %}
            <option value="{{ rad.id }}">{{ rad.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="flex items-center gap-4">
        <label class="flex items-center">
          <input type="checkbox" name="can_read" class="form-checkbox h-4 w-4 text-blue-600">
          <span class="ml-2 text-sm">Can Read</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" name="does_stats" class="form-checkbox h-4 w-4 text-blue-600">
          <span class="ml-2 text-sm">Does Stats</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" name="does_routines" class="form-checkbox h-4 w-4 text-blue-600">
          <span class="ml-2 text-sm">Does Routines</span>
        </label>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Stipulations</label>
        <textarea name="stipulations" class="w-full border rounded px-3 py-2 text-sm" rows="2"></textarea>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
        <textarea name="notes" class="w-full border rounded px-3 py-2 text-sm" rows="2"></textarea>
      </div>
      <div class="flex justify-end gap-3">
        <button type="button" onclick="closeRadiologistModal()" class="px-4 py-2 text-sm border rounded text-gray-700 hover:bg-gray-50">Cancel</button>
        <button type="submit" class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">Assign</button>
      </div>
    </form>
  </div>
</div>

<!-- Bulk Edit Assignments Modal -->
<div id="bulkEditAssignmentsModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center">
  <div class="bg-white rounded-lg shadow-lg w-[95%] max-w-4xl max-h-[90vh] overflow-y-auto p-6 relative">
    <button onclick="closeBulkEditAssignmentsModal()" class="absolute top-2 right-2 text-2xl font-bold text-gray-500 hover:text-black">√ó</button>
    <h3 class="text-xl font-semibold mb-4">Bulk Edit Assigned Radiologists</h3>
    <form method="POST" action="{{ url_for('dashboard.bulk_update_assignments', facility_id=facility.id) }}" class="space-y-4">
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 text-sm rounded">
          <thead class="bg-gray-100">
            <tr class="text-left">
              <th class="px-4 py-2 border-b">Name</th>
              <th class="px-4 py-2 border-b">Can Read</th>
              <th class="px-4 py-2 border-b">Does Stats</th>
              <th class="px-4 py-2 border-b">Does Routines</th>
              <th class="px-4 py-2 border-b">Stipulations</th>
              <th class="px-4 py-2 border-b">Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for assignment in doctor_assignments %}
            <tr>
              <td class="px-4 py-2 border-b font-medium">{{ assignment.radiologists.name }}</td>
              <td class="px-4 py-2 border-b text-center"><input type="checkbox" name="can_read_{{ assignment.id }}" {% if assignment.can_read %}checked{% endif %}></td>
              <td class="px-4 py-2 border-b text-center"><input type="checkbox" name="does_stats_{{ assignment.id }}" {% if assignment.does_stats %}checked{% endif %}></td>
              <td class="px-4 py-2 border-b text-center"><input type="checkbox" name="does_routines_{{ assignment.id }}" {% if assignment.does_routines %}checked{% endif %}></td>
              <td class="px-4 py-2 border-b"><textarea name="stipulations_{{ assignment.id }}" class="w-full border rounded px-2 py-1">{{ assignment.stipulations }}</textarea></td>
              <td class="px-4 py-2 border-b"><textarea name="notes_{{ assignment.id }}" class="w-full border rounded px-2 py-1">{{ assignment.notes }}</textarea></td>
              <input type="hidden" name="assignment_ids" value="{{ assignment.id }}">
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="flex justify-end gap-3 mt-4">
        <button type="button" onclick="closeBulkEditAssignmentsModal()" class="px-4 py-2 text-sm border rounded text-gray-700 hover:bg-gray-50">Cancel</button>
        <button type="submit" class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- Delete Contact Form (Hidden) -->
<form id="deleteContactForm" method="POST" style="display: none;"></form>

<script>
  function openContactModal() {
    document.getElementById('contactModal').classList.remove('hidden');
  }

  function closeContactModal() {
    document.getElementById('contactModal').classList.add('hidden');
  }

  function openAddContactModal() {
    document.getElementById('addContactModal').classList.remove('hidden');
  }

  function closeAddContactModal() {
    document.getElementById('addContactModal').classList.add('hidden');
  }

  function filterContacts(query) {
    const items = document.querySelectorAll('.contact-item');
    const q = query.toLowerCase();

    items.forEach(item => {
      const searchableContent = Array.from(item.querySelectorAll('.searchable'))
        .map(el => el.textContent.toLowerCase())
        .join(' ');
      
      item.style.display = searchableContent.includes(q) ? '' : 'none';
    });
  }

  function openEditContactModal() {
    document.getElementById('editContactModal').classList.remove('hidden');
  }

  function editContact(contact) {
    const form = document.getElementById('editContactForm');

    form.action = "{{ url_for('dashboard.edit_facility_contact', facility_id=facility.id, contact_id='CONTACT_ID') }}".replace('CONTACT_ID', contact.id);

    form.querySelector('[name="contact_name"]').value = contact.contact_name || '';
    form.querySelector('[name="role"]').value = contact.role || '';
    form.querySelector('[name="email"]').value = contact.email || '';
    form.querySelector('[name="phone"]').value = contact.phone || '';
    form.querySelector('[name="comments"]').value = contact.comments || '';

    openEditContactModal();
  }

  function closeEditContactModal() {
    document.getElementById('editContactModal').classList.add('hidden');
  }

  function deleteContact(contactId, facilityId) {
    if (confirm('Are you sure you want to delete this contact?')) {
        console.log('Deleting contact:', { contactId, facilityId }); // Debug log
        fetch(`/dashboard/facility/${facilityId}/contact/${contactId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        })
        .then(async (response) => {
            const text = await response.text();
            console.log('Response text:', text); // Debug log
            
            let data;
            try {
                data = JSON.parse(text);
            } catch (e) {
                throw new Error(`Invalid JSON response: ${text}`);
            }
            
            if (!response.ok) {
                throw new Error(data.error || `Server error ${response.status}`);
            }
            
            return data;
        })
        .then(data => {
            if (data.success) {
                window.location.reload();
            } else {
                alert('Error deleting contact: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(err => {
            console.error('Delete error:', err);
            alert('Error deleting contact: ' + err.message);
        });
    }
  }

  function toggleContactDetails(contactId) {
    const detailsDiv = document.getElementById(`details-${contactId}`);
    detailsDiv.classList.toggle('hidden');
  }

  function openRadiologistModal() {
    document.getElementById('radiologistModal').classList.remove('hidden');
  }
  
  function closeRadiologistModal() {
    document.getElementById('radiologistModal').classList.add('hidden');
  }
  
  function filterRadiologists(query) {
    const items = document.querySelectorAll('.radiologist-item');
    const q = query.toLowerCase();
  
    items.forEach(item => {
      const text = item.innerText.toLowerCase();
      item.style.display = text.includes(q) ? '' : 'none';
    });
  }

  function openBulkEditAssignmentsModal() {
    document.getElementById('bulkEditAssignmentsModal').classList.remove('hidden');
  }
  function closeBulkEditAssignmentsModal() {
    document.getElementById('bulkEditAssignmentsModal').classList.add('hidden');
  }
</script>
{% endblock %}